<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Transform 3D object between template brains — xform_brain • nat.templatebrains</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Transform 3D object between template brains — xform_brain" />
<meta property="og:description" content="Transform 3D object between template brains" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nat.templatebrains</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../SUPPORT.html">Help</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://natverse.github.io">natverse</a>
</li>
<li>
  <a href="https://github.com/natverse/nat.templatebrains">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Transform 3D object between template brains</h1>
    <small class="dont-index">Source: <a href='https://github.com/natverse/nat.templatebrains/blob/master/R/transformation.R'><code>R/transformation.R</code></a></small>
    <div class="hidden name"><code>xform_brain.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Transform 3D object between template brains</p>
    </div>

    <pre class="usage"><span class='fu'>xform_brain</span>(
  <span class='no'>x</span>,
  <span class='kw'>sample</span> <span class='kw'>=</span> <span class='fu'><a href='regtemplate.html'>regtemplate</a></span>(<span class='no'>x</span>),
  <span class='no'>reference</span>,
  <span class='kw'>via</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>imagedata</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>is.character</a></span>(<span class='no'>x</span>),
  <span class='kw'>checkboth</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>target</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>Verbose</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(),
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>the 3D object to be transformed</p></td>
    </tr>
    <tr>
      <th>sample</th>
      <td><p>Source template brain (e.g. IS2) that data is currently in.
Specified either as character vector or a <code>templatebrain</code> object.</p></td>
    </tr>
    <tr>
      <th>reference</th>
      <td><p>Target template brain (e.g. IS2) that data should be
transformed into.</p></td>
    </tr>
    <tr>
      <th>via</th>
      <td><p>(optional) intermediate template brain that the registration
sequence must pass through.</p></td>
    </tr>
    <tr>
      <th>imagedata</th>
      <td><p>Whether <code>x</code> should be treated as image data (presently
only supported as a file on disk) or 3D object vertices - see details.</p></td>
    </tr>
    <tr>
      <th>checkboth</th>
      <td><p>When <code>TRUE</code> will look for registrations in both
directions. See details.</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>When transforming image data, this specifies the target space
(defaults to <code>reference</code> when <code>imagedata=TRUE</code>). See Details.</p></td>
    </tr>
    <tr>
      <th>Verbose</th>
      <td><p>Whether to show a message with the sequence of template brains</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>extra arguments to pass to <code><a href='https://rdrr.io/pkg/nat/man/xform.html'>xform</a></code> and then on to
<code><a href='https://rdrr.io/pkg/nat/man/xformpoints.html'>xformpoints</a></code> or <code><a href='https://rdrr.io/pkg/nat/man/xformimage.html'>xformimage</a></code> which will
eventually hand off to <code>cmtk.reformatx</code> when using CMTK.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>NB the <code>sample</code>, <code>reference</code> and <code>via</code> brains can
  either be <code>templatebrain</code> objects or a character string containing the
  short name of the template e.g. <code>"IS2"</code>.</p>
<p><code>xform_brain</code> uses the helper function
  <code><a href='shortest_bridging_seq.html'>shortest_bridging_seq</a></code> to find the shortest path between
  different template brains based on the set of bridging registrations that
  the natverse has been informed about (see <code><a href='shortest_bridging_seq.html'>bridging_graph</a></code>).
  You can specify a <code>via</code> argument to ensure that the registrations
  passes through one or more intermediate templates. Note that when multiple
  brains are passed to <code>via</code> they should be in order from sample to
  reference. If you are passing multiple <code><a href='templatebrain.html'>templatebrain</a></code> objects,
  they must be wrapped in a list.</p>
<p>When transforming image data (<code>imagedata=TRUE</code>), the <code>target</code>
  argument should normally be specified. This defines the absolute/voxel
  dimensions of the target space. This can be calculated from a
  <code>templatebrain</code> object, so by default it will be set to the value of
  the <code>reference</code> argument. Alternatively an image file on disk can be
  specified; this is essential if the <code>reference</code> argument does not
  specify a <code><a href='templatebrain.html'>templatebrain</a></code> object but instead just names a
  template space (i.e. is a string).</p>
<p>The significance of the <code>imagedata</code> and <code>checkboth</code> arguments is
  that CMTK registrations are not directly invertible although they can be
  numerically inverted in most cases (unless there are regions where folding
  occurred). For image data, numerical inversion is <em>much</em> slower.</p>
<p>You can control whether you want to allow inverse registrations manually by
  setting <code>checkboth</code> explicitly. Otherwise when <code>checkboth=NULL</code>
  the default is to act as if <code>checkboth=T</code> but issue a warning if an
  inversion must be used.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='mirror_brain.html'>mirror_brain</a></code>, <code><a href='shortest_bridging_seq.html'>shortest_bridging_seq</a></code>
  <code><a href='shortest_bridging_seq.html'>bridging_graph</a></code>, <code><a href='regtemplate.html'>regtemplate</a></code>,
  <code>xform</code>. <code>xformpoints</code>, <code>xformimage</code>,
  <code>cmtk.reformatx</code> (for transforming image data with CMTK).</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## depends on nat.flybrains package and system CMTK installation</span>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'>## reformat neurons</span>
<span class='co'>##</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>nat.flybrains</span>)
<span class='co'># Plot Kenyon cells in their original FCWB template brain</span>
<span class='fu'>nopen3d</span>()
<span class='fu'>plot3d</span>(<span class='no'>kcs20</span>)
<span class='fu'>plot3d</span>(<span class='no'>FCWB</span>)
<span class='co'># Convert to JFCR2 template brain</span>
<span class='no'>kcs20.jfrc2</span><span class='kw'>=</span><span class='fu'>xform_brain</span>(<span class='no'>kcs20</span>, <span class='kw'>sample</span> <span class='kw'>=</span> <span class='no'>FCWB</span>, <span class='kw'>reference</span><span class='kw'>=</span><span class='no'>JFRC2</span>)
<span class='co'># now plot in the new JFRC2 space</span>
<span class='fu'>nopen3d</span>()
<span class='fu'>plot3d</span>(<span class='no'>kcs20.jfrc2</span>)
<span class='fu'>plot3d</span>(<span class='no'>JFRC2</span>)
<span class='co'># compare with the untransformed neurons</span>
<span class='fu'>plot3d</span>(<span class='no'>kcs20</span>)
<span class='co'># plot with neuropil sub regions for the left mushroom body</span>
<span class='fu'>clear3d</span>()
<span class='fu'>plot3d</span>(<span class='no'>kcs20.jfrc2</span>)
<span class='co'># nb "MB.*_L" is a regular expression</span>
<span class='fu'>plot3d</span>(<span class='no'>JFRC2NP.surf</span>, <span class='st'>"MB.*_L"</span>, <span class='kw'>alpha</span><span class='kw'>=</span><span class='fl'>0.3</span>)
<span class='co'># compare with originals - bridging registration is no perfect in peduncle</span>
<span class='fu'>nopen3d</span>()
<span class='fu'>plot3d</span>(<span class='no'>kcs20</span>)
<span class='fu'>plot3d</span>(<span class='no'>FCWBNP.surf</span>, <span class='st'>"MB.*_L"</span>, <span class='kw'>alpha</span><span class='kw'>=</span><span class='fl'>0.3</span>)

<span class='co'># insist on using a specific intermediate template brain</span>
<span class='co'># this would nor be an improvement in this case</span>
<span class='no'>kcs20.jfrc2viais2</span><span class='kw'>=</span><span class='fu'>xform_brain</span>(<span class='no'>kcs20</span>, <span class='kw'>sample</span> <span class='kw'>=</span> <span class='no'>FCWB</span>, <span class='kw'>via</span><span class='kw'>=</span><span class='no'>IS2</span>, <span class='kw'>reference</span><span class='kw'>=</span><span class='no'>JFRC2</span>)


<span class='co'>## reformat image examples</span>
<span class='co'># see ?cmtk.reformatx for details of any additional arguments</span>
<span class='co'># note that for image data a target space defining the dimensions of the</span>
<span class='co'># output image must be specified - this happens by default using the</span>
<span class='co'># reference templatebrain object</span>
<span class='fu'>xform_brain</span>(<span class='st'>'in.nrrd'</span>, <span class='kw'>sample</span><span class='kw'>=</span><span class='no'>FCWB</span>, <span class='kw'>ref</span><span class='kw'>=</span><span class='no'>JFRC2</span>, <span class='kw'>output</span><span class='kw'>=</span><span class='st'>'out.nrrd'</span>)
<span class='co'># or you can specify an image file explicitly as target</span>
<span class='fu'>xform_brain</span>(<span class='st'>'in.nrrd'</span>, <span class='kw'>sample</span><span class='kw'>=</span><span class='no'>FCWB</span>, <span class='kw'>ref</span><span class='kw'>=</span><span class='no'>JFRC2</span>, <span class='kw'>output</span><span class='kw'>=</span><span class='st'>'out.nrrd'</span>,
            <span class='kw'>target</span><span class='kw'>=</span><span class='st'>'JFRC2.nrrd'</span>)

<span class='co'># use partial volume interpolation for label field</span>
<span class='fu'>xform_brain</span>(<span class='st'>'labels.nrrd'</span>, <span class='kw'>sample</span><span class='kw'>=</span><span class='no'>FCWB</span>, <span class='kw'>ref</span><span class='kw'>=</span><span class='no'>JFRC2</span>, <span class='kw'>output</span><span class='kw'>=</span><span class='st'>'out.nrrd'</span>,
            <span class='kw'>interpolation</span><span class='kw'>=</span><span class='st'>'pv'</span>)

<span class='co'># use binary mask to restrict (and speed up) reformatting</span>
<span class='fu'>xform_brain</span>(<span class='st'>'in.nrrd'</span>, <span class='kw'>sample</span><span class='kw'>=</span><span class='no'>FCWB</span>, <span class='kw'>ref</span><span class='kw'>=</span><span class='no'>JFRC2</span>, <span class='kw'>output</span><span class='kw'>=</span><span class='st'>'out.nrrd'</span>, <span class='kw'>mask</span><span class='kw'>=</span><span class='st'>'neuropil.nrrd'</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Gregory Jefferis, James Manton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


